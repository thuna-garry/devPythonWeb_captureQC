F_URI="/capture/form/",captureApp.controller("captureFormWorkOrderStatusCtrl",["$scope","$http","Idle",function(o,r,e){function t(r){var e=o.form.flds.length;(!o.form.flds[r].group||e-1>r&&o.form.flds[r].group!=o.form.flds[r+1].group)&&(o.form.flds.length=r+1)}function n(e,t,n){function i(r){o.form=r[0],o.formMsgType=r[1],o.formMsg=r[2],o.bbox=r[3],f()}"undefined"==typeof t?r.get(F_URI+e).success(i).error(s):r.post(F_URI+o.form.name+"/fld_"+t,n).success(i).error(s)}function s(r){r=parseErrorResponse(r),"redirectTo"in r?window.location.replace(r.redirectTo):(o.errDialog=r,showErrDialog())}function f(){setTimeout(function(){var r="#"+o.form.name+"-"+o.form.flds[o.form.flds.length-1].name;$(".ajaxLoaded").trigger("create"),$(r).focus()},0)}o.aqcUtils=aqcUtils,o.events=[],o.$on("IdleStart",function(){showPopupDialog("idleDetected")}),o.$on("IdleWarn",function(o,r){$("#idleCountdown").html("Reset in "+r+"s")}),o.$on("IdleTimeout",function(){$("#idleCountdown").html("Reloading..."),o.reload()}),o.$on("IdleEnd",function(){hidePopupDialog("idleDetected")}),o.$on("Keepalive",function(){}),o.init=function(r){o.hideDesc=!1,r&&n(r)},o.reload=function(r){r=r||o.form.name,window.location.href=r+".html"},o.gotFocus=function(r){2==o.form.flds[r].w2cm&&(o.form.flds[r].msg=""),t(r)},o.change=function(r){e.watch(),o.formMsg="",1==o.form.flds[r].w2cm&&(o.form.flds[r].msg=""),o.form.flds[r].dirty=!0},o.entryDone=function(r,e){r>o.form.flds.length-1||(e=e||!1,(o.form.flds[r].dirty||e)&&(o.form.flds[r].dirty=!1,3==o.form.flds[r].w2cm&&(o.form.flds[r].msg=""),n(o.form.name,o.form.flds[r].name,{value:o.form.flds[r].value})))},o.showStatusDialog=function(r){o.formMsg="",o.curWorkOrder=r;var e=aqcUtils.getFldIdx(o.form,"workOrderList");o.statusList=o.form.flds[e].value,$("body").pagecontainer("change","#pageWoStatus",{transition:"slidedown"}),setTimeout(function(){$("#pageWoStatus").trigger("create"),$(".ui-listview").listview("refresh")},0)},o.saveStatus=function(e){function t(r){o.showOverlay=!1,o.curWorkOrder.wos_auto_key=e.wos_auto_key,o.curWorkOrder.wos_statusDesc=e.description,foo=r[0],o.formMsgType=r[1],o.formMsg=r[2],o.bbox=r[3]}o.formMsg="",$.mobile.back(),o.showOverlay=!0,r.post(F_URI+o.form.name+"/status",[o.curWorkOrder.woo_auto_key,e.wos_auto_key,o.curWorkOrder.si_number]).success(t).error(s)},o.cancelStatus=function(){$.mobile.back()}}]);
function getCookie(o){var e="; "+document.cookie,r=e.split("; "+o+"=");return 2==r.length?r.pop().split(";").shift():void 0}function defaultFor(o,e){return"undefined"!=typeof o?o:e}function showErrDialog(){showPopupDialog("dialogError")}function showPopupDialog(o){$("#"+o).css("width","85vw"),$("#"+o).css("display",""),$("#"+o).trigger("create"),$("#"+o).popup(),$("#"+o).popup("open",{positionTo:"window",transition:"pop"})}function hidePopupDialog(o){$("#"+o).popup("close"),$("#"+o).css("display","none")}function cssTransform(o,e){o.css("transform",e),o.css("-webkit-transform",e),o.css("-moz-transform",e),o.css("-o-transform",e),o.css("-ms-transform",e)}function cssScale(o,e){var r="scale("+e+")";cssTransform(o,r)}function parseErrorResponse(o){var e=/^\n$/m;return e.test(o)?JSON.parse(o.split(e)[1]):o}var aqcUtils=aqcUtils||{};aqcUtils.monthNamesShort=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],aqcUtils.monthNamesLong=["","January","February","March","April","May","June","July","August","September","October","November","December"],aqcUtils.getYearLookupList=function(o){var e=[];for(i=0;i<25;i++){var r=o.y-3+i;e[i]={seq:r,code:"y"+r,desc:r}}return e},aqcUtils.getMonthLookupList=function(o){var e=[];for(i=0;i<12;i++)e[i]={seq:i+1,code:"m"+(i+1),desc:aqcUtils.monthNamesLong[i+1]};return e},aqcUtils.getDayLookupList=function(o){var e=new Date(o.y,o.m,0).getDate(),r=[];for(i=0;i<e;i++)r[i]={seq:i+1,code:"d"+(i+1),desc:i+1};return r},aqcUtils.getFldIdx=function(o,e){if(void 0==o)return-1;for(var r=o.flds.length-1;r>=0;r--)if(o.flds[r].name==e)return r;return-1},aqcUtils.getFldType=function(o,e){if(void 0==o)return null;for(var r=o.flds.length-1;r>=0;r--)if(o.flds[r].name==e)return o.flds[r].type;return-1},aqcUtils.getFldAttr=function(o,e,r){return fldIdx=aqcUtils.getFldIdx(o,e),fldIdx<0?null:o.flds[fldIdx][r]};var captureApp=angular.module("captureApp",["ngLoadingSpinner","ngIdle"]).config(["$httpProvider",function(o){o.defaults.headers.common["X-CSRFToken"]=getCookie("csrftoken"),o.defaults.headers.common.AQC_TZ_OFFSET=(new Date).getTimezoneOffset()}]).run(function(){}).directive("aqcKeyedAdvance",function(){return function(o,e,r){e.bind("keydown keypress",function(e){(13===e.which||9===e.which)&&(o.$apply(function(){o.$eval(r.aqcKeyedAdvance)}),e.preventDefault())})}}).directive("aqcSelectOnFocus",function(){return{restrict:"A",link:function(o,e){e.on("focus",function(){this.select()})}}}).directive("aqcTapHold",function(){return{restrict:"A",link:function(o,e,r){e.bind("taphold",function(e){o.$apply(function(){o.$eval(r.aqcTapHold)}),e.preventDefault()})}}}).directive("aqcIdle",["Idle",function(o){return{restrict:"EA",scope:{aqcIdle:"@",aqcTimeout:"@"},link:function(e,r,t){o.setIdle(parseInt(e.aqcIdle)),o.setTimeout(parseInt(e.aqcTimeout))}}}]).directive("aqcClock",["dateFilter","$timeout",function(o,e){return{restrict:"E",scope:{format:"@"},link:function(r,t,n){var i=function(){var n=Date.now();t.html(o(n,r.format)),e(i,n%1e3)};i()}}}]).filter("unsafe",["$sce",function(o){return function(e){return o.trustAsHtml(e)}}]);F_URI="/capture/form/",captureApp.controller("captureFormBatchLabourCtrl",["$scope","$http","Idle",function(o,e,r){function t(e){var r=o.form.flds.length;(!o.form.flds[e].group||r-1>e&&o.form.flds[e].group!=o.form.flds[e+1].group)&&(o.form.flds.length=e+1)}function n(r,t,n){function s(e,r,t,n){o.form=e[0],o.formMsgType=e[1],o.formMsg=e[2],o.bbox=e[3],f()}"undefined"==typeof t?e.get(F_URI+r).success(s).error(i):e.post(F_URI+o.form.name+"/fld_"+t,n).success(s).error(i)}function i(e,r,t,n){e=parseErrorResponse(e),"redirectTo"in e?window.location.replace(e.redirectTo):(o.showOverlay=!1,o.errDialog=e,showErrDialog())}function f(){setTimeout(function(){var e="#"+o.form.name+"-"+o.form.flds[o.form.flds.length-1].name;$(".ajaxLoaded").trigger("create"),$(e).focus()},0)}o.aqcUtils=aqcUtils,o.events=[],o.$on("IdleStart",function(){showPopupDialog("idleDetected")}),o.$on("IdleWarn",function(o,e){$("#idleCountdown").html("Reset in "+e+"s")}),o.$on("IdleTimeout",function(){$("#idleCountdown").html("Reloading..."),o.reload()}),o.$on("IdleEnd",function(){hidePopupDialog("idleDetected")}),o.$on("Keepalive",function(){}),o.init=function(e){o.hideDesc=!1,e&&n(e)},o.reload=function(e){e=e||o.form.name,window.location.href=e+".html"},o.gotFocus=function(e){2==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),t(e)},o.change=function(e){r.watch(),o.formMsg="",o.form.dirty=!0,1==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),o.form.flds[e].dirty=!0},o.entryDone=function(e,r){e>o.form.flds.length-1||(r=r||!1,(o.form.flds[e].dirty||r)&&(o.form.flds[e].dirty=!1,3==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),n(o.form.name,o.form.flds[e].name,{value:o.form.flds[e].value})))},o.showTaskDialog=function(e){o.formMsg="",o.origWorkOrder=e,o.cloneWorkOrder=angular.copy(o.origWorkOrder),$("body").pagecontainer("change","#pageWoTasks",{transition:"slidedown"}),setTimeout(function(){$("#pageWoTasks").trigger("create"),$(".ui-listview").listview("refresh")},0)},o.taskSave=function(){function r(e,r,t,n){o.showOverlay=!1,foo=e[0],o.formMsgType=e[1],o.formMsg=e[2],o.bbox=e[3],angular.copy(o.cloneWorkOrder,o.origWorkOrder)}o.formMsg="",$.mobile.back(),o.showOverlay=!0,e.post(F_URI+o.form.name+"/woClockedTasks",o.cloneWorkOrder).success(r).error(i)},o.taskCancel=function(){$.mobile.back()},o.clockInOut=function(e){e.clockedIn=0==e.clockedIn?1:0,o.cloneWorkOrder.countTasksClockedIn+=e.clockedIn?1:-1},o.restartLastBatch=function(r){function t(e,r,t,n){o.showOverlay=!1,o.form=e[0],o.formMsgType=e[1],o.formMsg=e[2],o.bbox=e[3],f()}o.formMsg="",$("#panelOptions").panel("close",{}),o.showOverlay=!0,e.post(F_URI+o.form.name+"/restart",{}).success(t).error(i)},o.stopAllTasks=function(r){function t(e,r,t,n){o.showOverlay=!1,o.form=e[0],o.formMsgType=e[1],o.formMsg=e[2],o.bbox=e[3],f()}o.formMsg="",o.form.dirty="",$("#panelOptions").panel("close",{}),o.showOverlay=!0,e.post(F_URI+o.form.name+"/stopAllTasks",{}).success(t).error(i)}}]),F_URI="/capture/form/",captureApp.controller("captureFormCtrl",["$scope","$http","Idle","localService",function(o,e,r,t){function n(e){var r=o.form.flds.length;(!o.form.flds[e].group||r-1>e&&o.form.flds[e].group!=o.form.flds[e+1].group)&&(o.form.flds.length=e+1)}function i(r,t,n){function i(e,r,t,n){o.form=e[0],o.formMsgType=e[1],o.formMsg=e[2],o.bbox=e[3],s()}"undefined"==typeof t?e.get(F_URI+r).success(i).error(f):e.post(F_URI+o.form.name+"/fld_"+t,n).success(i).error(f)}function f(e,r,t,n){e=parseErrorResponse(e),"redirectTo"in e?window.location.replace(e.redirectTo):(o.errDialog=e,showErrDialog())}function s(){setTimeout(function(){var e="#"+o.form.name+"-"+o.form.flds[o.form.flds.length-1].name;$(".ajaxLoaded").trigger("create"),$(e).focus()},0)}o.localService=t,o.aqcUtils=aqcUtils,o.events=[],o.$on("IdleStart",function(){showPopupDialog("idleDetected")}),o.$on("IdleWarn",function(o,e){$("#idleCountdown").html("Reset in "+e+"s")}),o.$on("IdleTimeout",function(){$("#idleCountdown").html("Reloading..."),o.reload()}),o.$on("IdleEnd",function(){hidePopupDialog("idleDetected")}),o.$on("Keepalive",function(){}),o.init=function(e){o.hideDesc=!1,e&&i(e)},o.reload=function(e){e=e||o.form.name,window.location.href=e+".html"},o.gotFocus=function(e){2==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),n(e)},o.change=function(e){o.formMsg="",1==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),o.form.flds[e].dirty=!0},o.entryDone=function(e,r){e>o.form.flds.length-1||(r=r||!1,(o.form.flds[e].dirty||r)&&(o.form.flds[e].dirty=!1,3==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),i(o.form.name,o.form.flds[e].name,{value:o.form.flds[e].value})))},o.detailShow=function(r,t,n){function i(e,r,t,n){"!flds"==e[0]?o.form.flds.push.apply(o.form.flds,e[3]):o.curItemDetail=e[0],$("body").pagecontainer("change","#pageItemDetail",{transition:"slidedown"}),setTimeout(function(){$("#pageItemDetail").trigger("create"),$(".ui-listview").listview("refresh")},0)}o.formMsg="",o.curItem=n,o.curIdx=r,e.post(F_URI+o.form.name+"/"+t,n).success(i).error(f),s()},o.detailCancel=function(){$.mobile.back(),n(o.curIdx)},o.lookupShow=function(e,r,t,n){o.gotFocus(aqcUtils.getFldIdx(o.form,e.name)),o.lookupFld=e,o.lookupItems=r,o.lookupCurVal=defaultFor(n,e.value),$("body").pagecontainer("change","#"+t,{transition:"slidedown"}),setTimeout(function(){$("#"+t).trigger("create"),$(".ui-listview").listview("refresh")},0)},o.lookupSave=function(e){$.mobile.back(),i(o.form.name,o.lookupFld.name,{value:e.code})},o.lookupCancel=function(o){$.mobile.back()}}]),F_URI="/capture/form/",captureApp.controller("captureFormStockUndoCtrl",["$scope","$http","Idle",function(o,e,r){function t(e){var r=o.form.flds.length;(!o.form.flds[e].group||r-1>e&&o.form.flds[e].group!=o.form.flds[e+1].group)&&(o.form.flds.length=e+1)}function n(r,t,n){function s(e,r,t,n){o.form=e[0],o.formMsgType=e[1],o.formMsg=e[2],o.bbox=e[3],f()}"undefined"==typeof t?e.get(F_URI+r).success(s).error(i):e.post(F_URI+o.form.name+"/fld_"+t,n).success(s).error(i)}function i(e,r,t,n){e=parseErrorResponse(e),"redirectTo"in e?window.location.replace(e.redirectTo):(o.errDialog=e,showErrDialog())}function f(){setTimeout(function(){var e="#"+o.form.name+"-"+o.form.flds[o.form.flds.length-1].name;$(".ajaxLoaded").trigger("create"),$(e).focus()},0)}o.aqcUtils=aqcUtils,o.events=[],o.$on("IdleStart",function(){showPopupDialog("idleDetected")}),o.$on("IdleWarn",function(o,e){$("#idleCountdown").html("Reset in "+e+"s")}),o.$on("IdleTimeout",function(){$("#idleCountdown").html("Reloading..."),o.reload()}),o.$on("IdleEnd",function(){hidePopupDialog("idleDetected")}),o.$on("Keepalive",function(){}),o.init=function(e){o.hideDesc=!1,e&&n(e)},o.reload=function(e){e=e||o.form.name,window.location.href=e+".html"},o.gotFocus=function(e){2==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),t(e)},o.change=function(e){r.watch(),o.formMsg="",1==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),o.form.flds[e].dirty=!0},o.entryDone=function(e,r){e>o.form.flds.length-1||(r=r||!1,(o.form.flds[e].dirty||r)&&(o.form.flds[e].dirty=!1,3==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),n(o.form.name,o.form.flds[e].name,{value:o.form.flds[e].value})))},o.detailShow=function(r,t,n){function s(e,r,t,n){"!flds"==e[0]?o.form.flds.push.apply(o.form.flds,e[3]):o.curItemDetail=e[0],$("body").pagecontainer("change","#pageItemDetail",{transition:"slidedown"}),setTimeout(function(){$("#pageItemDetail").trigger("create"),$(".ui-listview").listview("refresh")},0),f()}o.formMsg="",o.curItem=n,o.curIdx=aqcUtils.getFldIdx(o.form,r),e.post(F_URI+o.form.name+"/"+t,n).success(s).error(i)},o.detEntryDone=function(r,n){function s(e,r,n,i){"!flds"==e[0]?(t(o.curIdx),o.form.flds.push.apply(o.form.flds,e[3])):($.mobile.back(),o.form=e[0],o.formMsgType=e[1],o.formMsg=e[2],o.bbox=e[3]),f()}r>o.form.flds.length-1||(n=n||!1,(o.form.flds[r].dirty||n)&&(o.form.flds[r].dirty=!1,3==o.form.flds[r].w2cm&&(o.form.flds[r].msg=""),e.post(F_URI+o.form.name+"/fld_"+o.form.flds[r].name,{stkTiItem:o.curItem,value:o.form.flds[r].value}).success(s).error(i)))},o.detailCancel=function(){$.mobile.back(),t(o.curIdx)}}]),F_URI="/capture/form/",captureApp.controller("captureFormWorkOrderStatusCtrl",["$scope","$http","Idle",function(o,e,r){function t(e){var r=o.form.flds.length;(!o.form.flds[e].group||r-1>e&&o.form.flds[e].group!=o.form.flds[e+1].group)&&(o.form.flds.length=e+1)}function n(r,t,n){function s(e,r,t,n){o.form=e[0],o.formMsgType=e[1],o.formMsg=e[2],o.bbox=e[3],f()}"undefined"==typeof t?e.get(F_URI+r).success(s).error(i):e.post(F_URI+o.form.name+"/fld_"+t,n).success(s).error(i)}function i(e,r,t,n){e=parseErrorResponse(e),"redirectTo"in e?window.location.replace(e.redirectTo):(o.showOverlay=!1,o.errDialog=e,showErrDialog())}function f(){setTimeout(function(){var e="#"+o.form.name+"-"+o.form.flds[o.form.flds.length-1].name;$(".ajaxLoaded").trigger("create"),$(e).focus()},0)}o.aqcUtils=aqcUtils,o.events=[],o.$on("IdleStart",function(){showPopupDialog("idleDetected")}),o.$on("IdleWarn",function(o,e){$("#idleCountdown").html("Reset in "+e+"s")}),o.$on("IdleTimeout",function(){$("#idleCountdown").html("Reloading..."),o.reload()}),o.$on("IdleEnd",function(){hidePopupDialog("idleDetected")}),o.$on("Keepalive",function(){}),o.init=function(e){o.hideDesc=!1,e&&n(e)},o.reload=function(e){e=e||o.form.name,window.location.href=e+".html"},o.gotFocus=function(e){2==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),t(e)},o.change=function(e){r.watch(),o.formMsg="",1==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),o.form.flds[e].dirty=!0},o.entryDone=function(e,r){e>o.form.flds.length-1||(r=r||!1,(o.form.flds[e].dirty||r)&&(o.form.flds[e].dirty=!1,3==o.form.flds[e].w2cm&&(o.form.flds[e].msg=""),n(o.form.name,o.form.flds[e].name,{value:o.form.flds[e].value})))},o.showStatusDialog=function(e){o.formMsg="",o.curWorkOrder=e;var r=aqcUtils.getFldIdx(o.form,"workOrderList");o.statusList=o.form.flds[r].value,$("body").pagecontainer("change","#pageWoStatus",{transition:"slidedown"}),setTimeout(function(){$("#pageWoStatus").trigger("create"),$(".ui-listview").listview("refresh")},0)},o.saveStatus=function(r){function t(e,t,n,i){o.showOverlay=!1,o.curWorkOrder.wos_auto_key=r.wos_auto_key,o.curWorkOrder.wos_statusDesc=r.description,foo=e[0],o.formMsgType=e[1],o.formMsg=e[2],o.bbox=e[3]}o.formMsg="",$.mobile.back(),o.showOverlay=!0,e.post(F_URI+o.form.name+"/status",[o.curWorkOrder.woo_auto_key,r.wos_auto_key,o.curWorkOrder.si_number]).success(t).error(i)},o.cancelStatus=function(){$.mobile.back()}}]),$(document).bind("mobileinit",function(){$.mobile.ajaxEnabled=!1});
//# sourceMappingURL=capture.min.js.map
/* Copyright AdvanceQC LLC 2014,2015.  All rights reserved */
function getCookie(o){o=("; "+document.cookie).split("; "+o+"=");if(2==o.length)return o.pop().split(";").shift()}function defaultFor(o,e){return void 0!==o?o:e}function showErrDialog(){showPopupDialog("dialogError")}function showPopupDialog(o){$("#"+o).css("width","85vw"),$("#"+o).css("display",""),$("#"+o).trigger("create"),$("#"+o).popup(),$("#"+o).popup("open",{positionTo:"window",transition:"pop"})}function hidePopupDialog(o){$("#"+o).popup("close"),$("#"+o).css("display","none")}function cssTransform(o,e){o.css("transform",e),o.css("-webkit-transform",e),o.css("-moz-transform",e),o.css("-o-transform",e),o.css("-ms-transform",e)}function cssScale(o,e){cssTransform(o,"scale("+e+")")}/* Copyright AdvanceQC LLC 2014,2015.  All rights reserved */
var aqcUtils=aqcUtils||{};function parseErrorResponse(o){var e=/^\n$/m;return e.test(o)?JSON.parse(o.split(e)[1]):o}aqcUtils.monthNamesShort=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],aqcUtils.monthNamesLong=["","January","February","March","April","May","June","July","August","September","October","November","December"],aqcUtils.getYearLookupList=function(o){var e=[];for(i=0;i<25;i++){var r=o.y-3+i;e[i]={seq:r,code:"y"+r,desc:r}}return e},aqcUtils.getMonthLookupList=function(o){var e=[];for(i=0;i<12;i++)e[i]={seq:i+1,code:"m"+(i+1),desc:aqcUtils.monthNamesLong[i+1]};return e},aqcUtils.getDayLookupList=function(o){var e=new Date(o.y,o.m,0).getDate(),r=[];for(i=0;i<e;i++)r[i]={seq:i+1,code:"d"+(i+1),desc:i+1};return r},aqcUtils.getFldIdx=function(o,e){if(null==o)return-1;for(var r=o.flds.length-1;0<=r;r--)if(o.flds[r].name==e)return r;return-1},aqcUtils.getFldType=function(o,e){if(null==o)return null;for(var r=o.flds.length-1;0<=r;r--)if(o.flds[r].name==e)return o.flds[r].type;return-1},aqcUtils.getFldAttr=function(o,e,r){return fldIdx=aqcUtils.getFldIdx(o,e),fldIdx<0?null:o.flds[fldIdx][r]};/* Copyright AdvanceQC LLC 2014,2015.  All rights reserved */
var captureApp=angular.module("captureApp",["ngLoadingSpinner","ngIdle"]).config(["$httpProvider",/*'IdleProvider', 'KeepaliveProvider',*/function(o/*, IdleProvider, KeepaliveProvider*/){o.defaults.headers.common["X-CSRFToken"]=getCookie("csrftoken"),o.defaults.headers.common.AQC_TZ_OFFSET=(new Date).getTimezoneOffset()}]).run(function(){
//stuff to do when app starts
}).directive("aqcKeyedAdvance",function(){return function(e,o,r){o.bind("keydown keypress",function(o){13!==o.which&&9!==o.which||(e.$apply(function(){e.$eval(r.aqcKeyedAdvance)}),o.preventDefault())})}}).directive("aqcSelectOnFocus",function(){return{restrict:"A",link:function(o,e){e.on("focus",function(){this.select()})}}}).directive("aqcTapHold",function(){return{restrict:"A",link:function(e,o,r){o.bind("taphold",function(o){e.$apply(function(){e.$eval(r.aqcTapHold)}),o.preventDefault()})}}}).directive("aqcIdle",["Idle",function(t){return{restrict:"EA",scope:{aqcIdle:"@",aqcTimeout:"@"},link:function(o,e,r){t.setIdle(parseInt(o.aqcIdle)),t.setTimeout(parseInt(o.aqcTimeout))}}}]).directive("aqcClock",["dateFilter","$timeout",function(n,i){return{restrict:"E",scope:{format:"@"},link:function(e,r,o){var t=function(){var o=Date.now();r.html(n(o,e.format)),i(t,o%1e3)};t()}}}]).filter("unsafe",["$sce",function(e){return function(o){return e.trustAsHtml(o)}}]);/* Copyright AdvanceQC LLC 2014,2015.  All rights reserved */
F_URI="/capture/form/",captureApp.controller("captureFormBatchLabourCtrl",["$scope","$http","Idle",function(n,i,e){function r(o,e,r){function t(o,e,r,t){n.form=o[0],n.formMsgType=o[1],n.formMsg=o[2],n.bbox=o[3],s()}(void 0===e?i.get(F_URI+o):i.post(F_URI+n.form.name+"/fld_"+e,r)).success(t).error(f)}function f(o,e,r,t){"redirectTo"in(o=parseErrorResponse(o))?window.location.replace(o.redirectTo):(n.showOverlay=!1,n.errDialog=o,showErrDialog())}function s(){setTimeout(function(){var o="#"+n.form.name+"-"+n.form.flds[n.form.flds.length-1].name;$(".ajaxLoaded").trigger("create"),$(o).focus()},0)}n.aqcUtils=aqcUtils,n.events=[],n.$on("IdleStart",function(){showPopupDialog("idleDetected")}),n.$on("IdleWarn",function(o,e){$("#idleCountdown").html("Reset in "+e+"s")}),n.$on("IdleTimeout",function(){$("#idleCountdown").html("Reloading..."),n.reload()}),n.$on("IdleEnd",function(){hidePopupDialog("idleDetected")}),n.$on("Keepalive",function(){}),n.init=function(o){n.hideDesc=!1,o&&r(o)},n.reload=function(o){o=o||n.form.name,window.location.href=o+".html"},n.gotFocus=function(o){var e;//remove all fields after the currently focused field
2==n.form.flds[o].w2cm&&(n.form.flds[o].msg=""),e=o,o=n.form.flds.length,(!n.form.flds[e].group||e<o-1&&n.form.flds[e].group!=n.form.flds[e+1].group)&&(n.form.flds.length=e+1)},n.change=function(o){e.watch(),n.formMsg="",n.form.dirty=!0,1==n.form.flds[o].w2cm&&(n.form.flds[o].msg=""),n.form.flds[o].dirty=!0},n.entryDone=function(o,e){o>n.form.flds.length-1||(//field no longer exists
e=e||!1,(n.form.flds[o].dirty||e)&&(//field is unchanged
n.form.flds[o].dirty=!1,3==n.form.flds[o].w2cm&&(n.form.flds[o].msg=""),r(n.form.name,n.form.flds[o].name,{value:n.form.flds[o].value})))},n.showTaskDialog=function(o){n.formMsg="",n.origWorkOrder=o,n.cloneWorkOrder=angular.copy(n.origWorkOrder),$("body").pagecontainer("change","#pageWoTasks",{/*role:'dialog',*/transition:"slidedown"}),setTimeout(function(){$("#pageWoTasks").trigger("create"),$(".ui-listview").listview("refresh")},0)},n.taskSave=function(){n.formMsg="",$.mobile.back(),n.showOverlay=!0,i.post(F_URI+n.form.name+"/woClockedTasks",n.cloneWorkOrder).success(function(o,e,r,t){n.showOverlay=!1,foo=o[0],n.formMsgType=o[1],n.formMsg=o[2],n.bbox=o[3],angular.copy(n.cloneWorkOrder,n.origWorkOrder)}).error(f)},n.taskCancel=function(){$.mobile.back()},n.clockInOut=function(o){o.clockedIn=0==o.clockedIn?1:0,n.cloneWorkOrder.countTasksClockedIn+=o.clockedIn?1:-1},n.restartLastBatch=function(o){n.formMsg="",$("#panelOptions").panel("close",{}),n.showOverlay=!0,i.post(F_URI+n.form.name+"/restart",{}).success(function(o,e,r,t){n.showOverlay=!1,n.form=o[0],n.formMsgType=o[1],n.formMsg=o[2],n.bbox=o[3],s()}).error(f)},n.stopAllTasks=function(o){n.formMsg="",n.form.dirty="",$("#panelOptions").panel("close",{}),n.showOverlay=!0,i.post(F_URI+n.form.name+"/stopAllTasks",{}).success(function(o,e,r,t){n.showOverlay=!1,n.form=o[0],n.formMsgType=o[1],n.formMsg=o[2],n.bbox=o[3],s()}).error(f)}}]),/* Copyright AdvanceQC LLC 2014,2015.  All rights reserved */
F_URI="/capture/form/",captureApp.controller("captureFormCtrl",["$scope","$http","Idle","localService",function(n,i,o,e){function r(o){var e=n.form.flds.length;(!n.form.flds[o].group||o<e-1&&n.form.flds[o].group!=n.form.flds[o+1].group)&&(n.form.flds.length=o+1)}function t(o,e,r){function t(o,e,r,t){n.form=o[0],n.formMsgType=o[1],n.formMsg=o[2],n.bbox=o[3],s()}(void 0===e?i.get(F_URI+o):i.post(F_URI+n.form.name+"/fld_"+e,r)).success(t).error(f)}function f(o,e,r,t){"redirectTo"in(o=parseErrorResponse(o))?window.location.replace(o.redirectTo):(n.errDialog=o,showErrDialog())}function s(){setTimeout(function(){var o="#"+n.form.name+"-"+n.form.flds[n.form.flds.length-1].name;$(".ajaxLoaded").trigger("create"),$(o).focus()},0)}n.localService=e,n.aqcUtils=aqcUtils,n.events=[],n.$on("IdleStart",function(){showPopupDialog("idleDetected")}),n.$on("IdleWarn",function(o,e){$("#idleCountdown").html("Reset in "+e+"s")}),n.$on("IdleTimeout",function(){$("#idleCountdown").html("Reloading..."),n.reload()}),n.$on("IdleEnd",function(){hidePopupDialog("idleDetected")}),n.$on("Keepalive",function(){}),n.init=function(o){n.hideDesc=!1,o&&t(o)},n.reload=function(o){o=o||n.form.name,window.location.href=o+".html"},n.gotFocus=function(o){//remove all fields after the currently focused field
2==n.form.flds[o].w2cm&&(n.form.flds[o].msg=""),r(o)},n.change=function(o){
//                     if ( ! Idle.running() )
//                     Idle.watch();
n.formMsg="",1==n.form.flds[o].w2cm&&(n.form.flds[o].msg=""),n.form.flds[o].dirty=!0},n.entryDone=function(o,e){o>n.form.flds.length-1||(//field no longer exists
e=e||!1,(n.form.flds[o].dirty||e)&&(n.form.flds[o].dirty=!1,3==n.form.flds[o].w2cm&&(n.form.flds[o].msg=""),t(n.form.name,n.form.flds[o].name,{value:n.form.flds[o].value})))},n.detailShow=function(o,e,r){n.formMsg="",n.curItem=r,n.curIdx=o,i.post(F_URI+n.form.name+"/"+e,r).success(function(o,e,r,t){"!flds"==o[0]?n.form.flds.push.apply(n.form.flds,o[3]):n.curItemDetail=o[0];$("body").pagecontainer("change","#pageItemDetail",{/*role:'dialog',*/transition:"slidedown"}),setTimeout(function(){$("#pageItemDetail").trigger("create"),$(".ui-listview").listview("refresh")},0)}).error(f),s()},n.detailCancel=function(){$.mobile.back(),r(n.curIdx)},n.lookupShow=function(o,e,r,t){n.gotFocus(aqcUtils.getFldIdx(n.form,o.name)),n.lookupFld=o,n.lookupItems=e,n.lookupCurVal=defaultFor(t,o.value),$("body").pagecontainer("change","#"+r,{/*role:'dialog',*/transition:"slidedown"}),setTimeout(function(){$("#"+r).trigger("create"),$(".ui-listview").listview("refresh")},0)},n.lookupSave=function(o){$.mobile.back(),t(n.form.name,n.lookupFld.name,{value:o.code})},n.lookupCancel=function(o){$.mobile.back()}}]),/* Copyright AdvanceQC LLC 2014,2015.  All rights reserved */
F_URI="/capture/form/",captureApp.controller("captureFormStockUndoCtrl",["$scope","$http","Idle",function(n,i,e){function f(o){var e=n.form.flds.length;(!n.form.flds[o].group||o<e-1&&n.form.flds[o].group!=n.form.flds[o+1].group)&&(n.form.flds.length=o+1)}function r(o,e,r){function t(o,e,r,t){n.form=o[0],n.formMsgType=o[1],n.formMsg=o[2],n.bbox=o[3],l()}(void 0===e?i.get(F_URI+o):i.post(F_URI+n.form.name+"/fld_"+e,r)).success(t).error(s)}function s(o,e,r,t){"redirectTo"in(o=parseErrorResponse(o))?window.location.replace(o.redirectTo):(n.errDialog=o,showErrDialog())}function l(){setTimeout(function(){var o="#"+n.form.name+"-"+n.form.flds[n.form.flds.length-1].name;$(".ajaxLoaded").trigger("create"),$(o).focus()},0)}n.aqcUtils=aqcUtils,n.events=[],n.$on("IdleStart",function(){showPopupDialog("idleDetected")}),n.$on("IdleWarn",function(o,e){$("#idleCountdown").html("Reset in "+e+"s")}),n.$on("IdleTimeout",function(){$("#idleCountdown").html("Reloading..."),n.reload()}),n.$on("IdleEnd",function(){hidePopupDialog("idleDetected")}),n.$on("Keepalive",function(){}),n.init=function(o){n.hideDesc=!1,o&&r(o)},n.reload=function(o){o=o||n.form.name,window.location.href=o+".html"},n.gotFocus=function(o){//remove all fields after the currently focused field
2==n.form.flds[o].w2cm&&(n.form.flds[o].msg=""),f(o)},n.change=function(o){e.watch(),n.formMsg="",1==n.form.flds[o].w2cm&&(n.form.flds[o].msg=""),n.form.flds[o].dirty=!0},n.entryDone=function(o,e){o>n.form.flds.length-1||(//field no longer exists
e=e||!1,(n.form.flds[o].dirty||e)&&(//field is unchanged
n.form.flds[o].dirty=!1,3==n.form.flds[o].w2cm&&(n.form.flds[o].msg=""),r(n.form.name,n.form.flds[o].name,{value:n.form.flds[o].value})))},n.detailShow=function(o,e,r){n.formMsg="",n.curItem=r,n.curIdx=aqcUtils.getFldIdx(n.form,o),i.post(F_URI+n.form.name+"/"+e,r).success(function(o,e,r,t){"!flds"==o[0]?n.form.flds.push.apply(n.form.flds,o[3]):n.curItemDetail=o[0];$("body").pagecontainer("change","#pageItemDetail",{/*role:'dialog',*/transition:"slidedown"}),setTimeout(function(){$("#pageItemDetail").trigger("create"),$(".ui-listview").listview("refresh")},0),l()}).error(s)},n.detEntryDone=function(o,e){o>n.form.flds.length-1||(//field no longer exists
e=e||!1,(n.form.flds[o].dirty||e)&&(//field is unchanged
n.form.flds[o].dirty=!1,3==n.form.flds[o].w2cm&&(n.form.flds[o].msg=""),i.post(F_URI+n.form.name+"/fld_"+n.form.flds[o].name,{stkTiItem:n.curItem,value:n.form.flds[o].value}).success(function(o,e,r,t){"!flds"==o[0]?(f(n.curIdx),n.form.flds.push.apply(n.form.flds,o[3])):($.mobile.back(),n.form=o[0],n.formMsgType=o[1],n.formMsg=o[2],n.bbox=o[3]);l()}).error(s)))},n.detailCancel=function(){$.mobile.back(),f(n.curIdx)}}]),/* Copyright AdvanceQC LLC 2014,2015.  All rights reserved */
F_URI="/capture/form/",captureApp.controller("captureFormWorkOrderStatusCtrl",["$scope","$http","Idle",function(i,f,e){function r(o,e,r){function t(o,e,r,t){i.form=o[0],i.formMsgType=o[1],i.formMsg=o[2],i.bbox=o[3],setTimeout(function(){var o="#"+i.form.name+"-"+i.form.flds[i.form.flds.length-1].name;$(".ajaxLoaded").trigger("create"),$(o).focus()},0)}(void 0===e?f.get(F_URI+o):f.post(F_URI+i.form.name+"/fld_"+e,r)).success(t).error(s)}function s(o,e,r,t){"redirectTo"in(o=parseErrorResponse(o))?window.location.replace(o.redirectTo):(i.showOverlay=!1,i.errDialog=o,showErrDialog())}i.aqcUtils=aqcUtils,i.events=[],i.$on("IdleStart",function(){showPopupDialog("idleDetected")}),i.$on("IdleWarn",function(o,e){$("#idleCountdown").html("Reset in "+e+"s")}),i.$on("IdleTimeout",function(){$("#idleCountdown").html("Reloading..."),i.reload()}),i.$on("IdleEnd",function(){hidePopupDialog("idleDetected")}),i.$on("Keepalive",function(){}),i.init=function(o){i.hideDesc=!1,o&&r(o)},i.reload=function(o){o=o||i.form.name,window.location.href=o+".html"},i.gotFocus=function(o){var e;//remove all fields after the currently focused field
2==i.form.flds[o].w2cm&&(i.form.flds[o].msg=""),e=o,o=i.form.flds.length,(!i.form.flds[e].group||e<o-1&&i.form.flds[e].group!=i.form.flds[e+1].group)&&(i.form.flds.length=e+1)},i.change=function(o){e.watch(),i.formMsg="",1==i.form.flds[o].w2cm&&(i.form.flds[o].msg=""),i.form.flds[o].dirty=!0},i.entryDone=function(o,e){o>i.form.flds.length-1||(//field no longer exists
e=e||!1,(i.form.flds[o].dirty||e)&&(//field is unchanged
i.form.flds[o].dirty=!1,3==i.form.flds[o].w2cm&&(i.form.flds[o].msg=""),r(i.form.name,i.form.flds[o].name,{value:i.form.flds[o].value})))},i.showStatusDialog=function(o){i.formMsg="",i.curWorkOrder=o;o=aqcUtils.getFldIdx(i.form,"workOrderList");i.statusList=i.form.flds[o].value,$("body").pagecontainer("change","#pageWoStatus",{/*role:'dialog',*/transition:"slidedown"}),setTimeout(function(){$("#pageWoStatus").trigger("create"),$(".ui-listview").listview("refresh")},0)},i.saveStatus=function(n){i.formMsg="",$.mobile.back(),i.showOverlay=!0,f.post(F_URI+i.form.name+"/status",[i.curWorkOrder.woo_auto_key,n.wos_auto_key,i.curWorkOrder.si_number]).success(function(o,e,r,t){i.showOverlay=!1,i.curWorkOrder.wos_auto_key=n.wos_auto_key,i.curWorkOrder.wos_statusDesc=n.description,foo=o[0],i.formMsgType=o[1],i.formMsg=o[2],i.bbox=o[3]}).error(s)},i.cancelStatus=function(){$.mobile.back()}}]),/* Copyright AdvanceQC LLC 2014,2015.  All rights reserved */
$(document).bind("mobileinit",function(){$.mobile.ajaxEnabled=!1});
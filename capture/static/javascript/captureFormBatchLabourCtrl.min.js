F_URI="/capture/form/",captureApp.controller("captureFormBatchLabourCtrl",["$scope","$http","Idle",function(o,r,e){function n(r){var e=o.form.flds.length;(!o.form.flds[r].group||e-1>r&&o.form.flds[r].group!=o.form.flds[r+1].group)&&(o.form.flds.length=r+1)}function s(e,n,s){function l(r){o.form=r[0],o.formMsgType=r[1],o.formMsg=r[2],o.bbox=r[3],f()}"undefined"==typeof n?r.get(F_URI+e).success(l).error(t):r.post(F_URI+o.form.name+"/fld_"+n,s).success(l).error(t)}function t(r){r=parseErrorResponse(r),"redirectTo"in r?window.location.replace(r.redirectTo):(o.errDialog=r,showErrDialog())}function f(){setTimeout(function(){var r="#"+o.form.name+"-"+o.form.flds[o.form.flds.length-1].name;$(".ajaxLoaded").trigger("create"),$(r).focus()},0)}o.aqcUtils=aqcUtils,o.events=[],o.$on("IdleStart",function(){showPopupDialog("idleDetected")}),o.$on("IdleWarn",function(o,r){$("#idleCountdown").html("Reset in "+r+"s")}),o.$on("IdleTimeout",function(){$("#idleCountdown").html("Reloading..."),o.reload()}),o.$on("IdleEnd",function(){hidePopupDialog("idleDetected")}),o.$on("Keepalive",function(){}),o.init=function(r){o.hideDesc=!1,r&&s(r)},o.reload=function(r){r=r||o.form.name,window.location.href=r+".html"},o.gotFocus=function(r){2==o.form.flds[r].w2cm&&(o.form.flds[r].msg=""),n(r)},o.change=function(r){e.watch(),o.formMsg="",o.form.dirty=!0,1==o.form.flds[r].w2cm&&(o.form.flds[r].msg=""),o.form.flds[r].dirty=!0},o.entryDone=function(r,e){r>o.form.flds.length-1||(e=e||!1,(o.form.flds[r].dirty||e)&&(o.form.flds[r].dirty=!1,3==o.form.flds[r].w2cm&&(o.form.flds[r].msg=""),s(o.form.name,o.form.flds[r].name,{value:o.form.flds[r].value})))},o.showTaskDialog=function(r){o.formMsg="",o.origWorkOrder=r,o.cloneWorkOrder=angular.copy(o.origWorkOrder),$("body").pagecontainer("change","#pageWoTasks",{transition:"slidedown"}),setTimeout(function(){$("#pageWoTasks").trigger("create"),$(".ui-listview").listview("refresh")},0)},o.taskSave=function(){function e(r){o.showOverlay=!1,foo=r[0],o.formMsgType=r[1],o.formMsg=r[2],o.bbox=r[3],angular.copy(o.cloneWorkOrder,o.origWorkOrder)}o.formMsg="",$.mobile.back(),o.showOverlay=!0,r.post(F_URI+o.form.name+"/woClockedTasks",o.cloneWorkOrder).success(e).error(t)},o.taskCancel=function(){$.mobile.back()},o.clockInOut=function(r){r.clockedIn=0==r.clockedIn?1:0,o.cloneWorkOrder.countTasksClockedIn+=r.clockedIn?1:-1},o.restartLastBatch=function(){function e(r){o.showOverlay=!1,o.form=r[0],o.formMsgType=r[1],o.formMsg=r[2],o.bbox=r[3],f()}o.formMsg="",$("#panelOptions").panel("close",{}),o.showOverlay=!0,r.post(F_URI+o.form.name+"/restart",{}).success(e).error(t)},o.stopAllTasks=function(){function e(r){o.showOverlay=!1,o.form=r[0],o.formMsgType=r[1],o.formMsg=r[2],o.bbox=r[3],f()}o.formMsg="",o.form.dirty="",$("#panelOptions").panel("close",{}),o.showOverlay=!0,r.post(F_URI+o.form.name+"/stopAllTasks",{}).success(e).error(t)}}]);